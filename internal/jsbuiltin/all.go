package jsbuiltin

var modules []JsModule

func init() {
	// builtin_cli.js
	modules = append(modules, JsModule{File: "builtin_cli.js", Code: "Y29uc3QgY2xpID0ge307Cgp7CiAgY29uc3QgX2FyZ3MgPSAoY2xpLl9hcmdzID0gW10pOwogIGNvbnN0IF9vcHRzID0gKGNsaS5fb3B0cyA9IHt9KTsKCiAgZnVuY3Rpb24gZ2V0RmxhZ05hbWUocykgewogICAgaWYgKHMuc3RhcnRzV2l0aCgiLS0iKSkgewogICAgICByZXR1cm4gcy5zbGljZSgyKTsKICAgIH0KICAgIGlmIChzLnN0YXJ0c1dpdGgoIi0iKSkgewogICAgICByZXR1cm4gcy5zbGljZSgxKTsKICAgIH0KICB9CgogIGZvciAobGV0IGkgPSAyOyBpIDwgX19hcmdzLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCB2ID0gX19hcmdzW2ldOwogICAgY29uc3QgdjIgPSBfX2FyZ3NbaSArIDFdOwogICAgaWYgKHYuc3RhcnRzV2l0aCgiLSIpKSB7CiAgICAgIGNvbnN0IHIgPSB2Lm1hdGNoKC9eLS0/KFtcd1wtX10rKT0oLiopJC8pOwogICAgICBpZiAocikgewogICAgICAgIF9vcHRzW3JbMV1dID0gclsyXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodjIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHYyLnN0YXJ0c1dpdGgoIi0iKSkgewogICAgICAgICAgICBfb3B0c1tnZXRGbGFnTmFtZSh2KV0gPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX29wdHNbZ2V0RmxhZ05hbWUodildID0gdjI7CiAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgX29wdHNbZ2V0RmxhZ05hbWUodildID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIF9hcmdzLnB1c2godik7CiAgICB9CiAgfQoKICBjbGkuZ2V0ID0gZnVuY3Rpb24gZ2V0KG4pIHsKICAgIGlmICh0eXBlb2YgbiA9PT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIF9hcmdzW25dOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIF9vcHRzW25dOwogICAgfQogIH07CgogIGNsaS5ib29sID0gZnVuY3Rpb24gYm9vbChuKSB7CiAgICBpZiAoX29wdHNbbl0gPT09IGZhbHNlIHx8IF9vcHRzW25dID09PSB1bmRlZmluZWQpIHJldHVybiBmYWxzZTsKICAgIGlmIChfb3B0c1tuXSA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7CiAgICBjb25zdCBzID0gX29wdHNbbl0udG9Mb3dlckNhc2UoKTsKICAgIHJldHVybiAhKHMgPT09ICIwIiB8fCBzID09PSAiZiIgfHwgcyA9PT0gImZhbHNlIik7CiAgfTsKCiAgY2xpLmFyZ3MgPSBmdW5jdGlvbiBhcmdzKCkgewogICAgcmV0dXJuIFsuLi5fYXJnc107CiAgfTsKCiAgY2xpLm9wdHMgPSBmdW5jdGlvbiBvcHRzKCkgewogICAgcmV0dXJuIHsgLi4uX29wdHMgfTsKICB9OwoKICBjbGkucHJvbXB0ID0gZnVuY3Rpb24gcHJvbXB0KG1lc3NhZ2UpIHsKICAgIGlmIChtZXNzYWdlKSBwcmludChtZXNzYWdlKTsKICAgIHJldHVybiByZWFkbGluZSgpOwogIH07CgogIGNsaS5fc3ViY29tbWFuZCA9IHt9OwoKICBjbGkuc3ViY29tbWFuZCA9IGZ1bmN0aW9uIHN1YmNvbW1hbmQobmFtZSwgY2FsbGJhY2spIHsKICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09IGBmdW5jdGlvbmApIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgY2FsbGJhY2sgZXhwZWN0ZWQgYSBmdW5jdGlvbmApOwogICAgfQogICAgaWYgKGNsaS5fc3ViY29tbWFuZFtuYW1lXSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYHN1YmNvbW1hbmQgJHtuYW1lfSBpcyBhbHJlYWR5IHJlZ2lzdGVyZWRgKTsKICAgIH0KICAgIGNsaS5fc3ViY29tbWFuZFtuYW1lXSA9IGNhbGxiYWNrOwogIH07CgogIGNsaS5zdWJjb21tYW5kc3RhcnQgPSBmdW5jdGlvbiBzdWJjb21tYW5kc3RhcnQoKSB7CiAgICBjb25zdCBuYW1lID0gY2xpLmdldCgwKTsKICAgIGlmIChjbGkuX3N1YmNvbW1hbmRbbmFtZV0pIHsKICAgICAgcmV0dXJuIGNsaS5fc3ViY29tbWFuZFtuYW1lXSgpOwogICAgfQogICAgaWYgKGNsaS5fc3ViY29tbWFuZFtgKmBdKSB7CiAgICAgIHJldHVybiBjbGkuX3N1YmNvbW1hbmRbYCpgXSgpOwogICAgfQogICAgdGhyb3cgbmV3IEVycm9yKGB1bnJlY29nbml6ZWQgc3ViY29tbWFuZCAke25hbWV9YCk7CiAgfTsKfQo="})

	// builtin_global.js
	modules = append(modules, JsModule{File: "builtin_global.js", Code: "ZnVuY3Rpb24gcmFuZG9tc3RyaW5nKHNpemUsIGNoYXJzKSB7CiAgc2l6ZSA9IHNpemUgfHwgNjsKICBjaGFycyA9CiAgICBjaGFycyB8fCAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkiOwogIGNvbnN0IG1heCA9IGNoYXJzLmxlbmd0aDsKICBsZXQgcmV0ID0gIiI7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgIHJldCArPSBjaGFycy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KSk7CiAgfQogIHJldHVybiByZXQ7Cn0KCmZ1bmN0aW9uIGZvcm1hdGRhdGUoZm9ybWF0LCB0aW1lc3RhbXApIHsKICAvLyAgZGlzY3VzcyBhdDogaHR0cDovL3BocGpzLm9yZy9mdW5jdGlvbnMvZGF0ZS8KICAvLyAgIGV4YW1wbGUgMTogZGF0ZSgnSDptOnMgXFxtIFxcaVxccyBcXG1cXG9cXG5cXHRcXGgnLCAxMDYyNDAyNDAwKTsKICAvLyAgIHJldHVybnMgMTogJzA5OjA5OjQwIG0gaXMgbW9udGgnCiAgLy8gICBleGFtcGxlIDI6IGRhdGUoJ0YgaiwgWSwgZzppIGEnLCAxMDYyNDYyNDAwKTsKICAvLyAgIHJldHVybnMgMjogJ1NlcHRlbWJlciAyLCAyMDAzLCAyOjI2IGFtJwogIC8vICAgZXhhbXBsZSAzOiBkYXRlKCdZIFcgbycsIDEwNjI0NjI0MDApOwogIC8vICAgcmV0dXJucyAzOiAnMjAwMyAzNiAyMDAzJwogIC8vICAgZXhhbXBsZSA0OiB4ID0gZGF0ZSgnWSBtIGQnLCAobmV3IERhdGUoKSkuZ2V0VGltZSgpLzEwMDApOwogIC8vICAgZXhhbXBsZSA0OiAoeCsnJykubGVuZ3RoID09IDEwIC8vIDIwMDkgMDEgMDkKICAvLyAgIHJldHVybnMgNDogdHJ1ZQogIC8vICAgZXhhbXBsZSA1OiBkYXRlKCdXJywgMTEwNDUzNDAwMCk7CiAgLy8gICByZXR1cm5zIDU6ICc1MycKICAvLyAgIGV4YW1wbGUgNjogZGF0ZSgnQiB0JywgMTEwNDUzNDAwMCk7CiAgLy8gICByZXR1cm5zIDY6ICc5OTkgMzEnCiAgLy8gICBleGFtcGxlIDc6IGRhdGUoJ1cgVScsIDEyOTM3NTAwMDAuODIpOyAvLyAyMDEwLTEyLTMxCiAgLy8gICByZXR1cm5zIDc6ICc1MiAxMjkzNzUwMDAwJwogIC8vICAgZXhhbXBsZSA4OiBkYXRlKCdXJywgMTI5MzgzNjQwMCk7IC8vIDIwMTEtMDEtMDEKICAvLyAgIHJldHVybnMgODogJzUyJwogIC8vICAgZXhhbXBsZSA5OiBkYXRlKCdXIFktbS1kJywgMTI5Mzk3NDA1NCk7IC8vIDIwMTEtMDEtMDIKICAvLyAgIHJldHVybnMgOTogJzUyIDIwMTEtMDEtMDInCgogIGxldCBqc2RhdGUsIGY7CiAgLy8gS2VlcCB0aGlzIGhlcmUgKHdvcmtzLCBidXQgZm9yIGNvZGUgY29tbWVudGVkLW91dCBiZWxvdyBmb3IgZmlsZSBzaXplIHJlYXNvbnMpCiAgLy8gdmFyIHRhbD0gW107CiAgY29uc3QgdHh0X3dvcmRzID0gWwogICAgIlN1biIsCiAgICAiTW9uIiwKICAgICJUdWVzIiwKICAgICJXZWRuZXMiLAogICAgIlRodXJzIiwKICAgICJGcmkiLAogICAgIlNhdHVyIiwKICAgICJKYW51YXJ5IiwKICAgICJGZWJydWFyeSIsCiAgICAiTWFyY2giLAogICAgIkFwcmlsIiwKICAgICJNYXkiLAogICAgIkp1bmUiLAogICAgIkp1bHkiLAogICAgIkF1Z3VzdCIsCiAgICAiU2VwdGVtYmVyIiwKICAgICJPY3RvYmVyIiwKICAgICJOb3ZlbWJlciIsCiAgICAiRGVjZW1iZXIiLAogIF07CiAgLy8gdHJhaWxpbmcgYmFja3NsYXNoIC0+IChkcm9wcGVkKQogIC8vIGEgYmFja3NsYXNoIGZvbGxvd2VkIGJ5IGFueSBjaGFyYWN0ZXIgKGluY2x1ZGluZyBiYWNrc2xhc2gpIC0+IHRoZSBjaGFyYWN0ZXIKICAvLyBlbXB0eSBzdHJpbmcgLT4gZW1wdHkgc3RyaW5nCiAgY29uc3QgZm9ybWF0Q2hyID0gL1xcPyguPykvZ2k7CiAgY29uc3QgZm9ybWF0Q2hyQ2IgPSBmdW5jdGlvbiAodCwgcykgewogICAgcmV0dXJuIGZbdF0gPyBmW3RdKCkgOiBzOwogIH07CiAgY29uc3QgX3BhZCA9IGZ1bmN0aW9uIChuLCBjKSB7CiAgICBuID0gU3RyaW5nKG4pOwogICAgd2hpbGUgKG4ubGVuZ3RoIDwgYykgewogICAgICBuID0gIjAiICsgbjsKICAgIH0KICAgIHJldHVybiBuOwogIH07CiAgZiA9IHsKICAgIC8vIERheQogICAgZCgpIHsKICAgICAgLy8gRGF5IG9mIG1vbnRoIHcvbGVhZGluZyAwOyAwMS4uMzEKICAgICAgcmV0dXJuIF9wYWQoZi5qKCksIDIpOwogICAgfSwKICAgIEQoKSB7CiAgICAgIC8vIFNob3J0aGFuZCBkYXkgbmFtZTsgTW9uLi4uU3VuCiAgICAgIHJldHVybiBmLmwoKS5zbGljZSgwLCAzKTsKICAgIH0sCiAgICBqKCkgewogICAgICAvLyBEYXkgb2YgbW9udGg7IDEuLjMxCiAgICAgIHJldHVybiBqc2RhdGUuZ2V0RGF0ZSgpOwogICAgfSwKICAgIGwoKSB7CiAgICAgIC8vIEZ1bGwgZGF5IG5hbWU7IE1vbmRheS4uLlN1bmRheQogICAgICByZXR1cm4gdHh0X3dvcmRzW2YudygpXSArICJkYXkiOwogICAgfSwKICAgIE4oKSB7CiAgICAgIC8vIElTTy04NjAxIGRheSBvZiB3ZWVrOyAxW01vbl0uLjdbU3VuXQogICAgICByZXR1cm4gZi53KCkgfHwgNzsKICAgIH0sCiAgICBTKCkgewogICAgICAvLyBPcmRpbmFsIHN1ZmZpeCBmb3IgZGF5IG9mIG1vbnRoOyBzdCwgbmQsIHJkLCB0aAogICAgICBjb25zdCBqID0gZi5qKCk7CiAgICAgIGxldCBpID0gaiAlIDEwOwogICAgICBpZiAoaSA8PSAzICYmIHBhcnNlSW50KChqICUgMTAwKSAvIDEwLCAxMCkgPT09IDEpIHsKICAgICAgICBpID0gMDsKICAgICAgfQogICAgICByZXR1cm4gWyJzdCIsICJuZCIsICJyZCJdW2kgLSAxXSB8fCAidGgiOwogICAgfSwKICAgIHcoKSB7CiAgICAgIC8vIERheSBvZiB3ZWVrOyAwW1N1bl0uLjZbU2F0XQogICAgICByZXR1cm4ganNkYXRlLmdldERheSgpOwogICAgfSwKICAgIHooKSB7CiAgICAgIC8vIERheSBvZiB5ZWFyOyAwLi4zNjUKICAgICAgY29uc3QgYSA9IG5ldyBEYXRlKGYuWSgpLCBmLm4oKSAtIDEsIGYuaigpKTsKICAgICAgY29uc3QgYiA9IG5ldyBEYXRlKGYuWSgpLCAwLCAxKTsKICAgICAgcmV0dXJuIE1hdGgucm91bmQoKGEgLSBiKSAvIDg2NGU1KTsKICAgIH0sCgogICAgLy8gV2VlawogICAgVygpIHsKICAgICAgLy8gSVNPLTg2MDEgd2VlayBudW1iZXIKICAgICAgY29uc3QgYSA9IG5ldyBEYXRlKGYuWSgpLCBmLm4oKSAtIDEsIGYuaigpIC0gZi5OKCkgKyAzKTsKICAgICAgY29uc3QgYiA9IG5ldyBEYXRlKGEuZ2V0RnVsbFllYXIoKSwgMCwgNCk7CiAgICAgIHJldHVybiBfcGFkKDEgKyBNYXRoLnJvdW5kKChhIC0gYikgLyA4NjRlNSAvIDcpLCAyKTsKICAgIH0sCgogICAgLy8gTW9udGgKICAgIEYoKSB7CiAgICAgIC8vIEZ1bGwgbW9udGggbmFtZTsgSmFudWFyeS4uLkRlY2VtYmVyCiAgICAgIHJldHVybiB0eHRfd29yZHNbNiArIGYubigpXTsKICAgIH0sCiAgICBtKCkgewogICAgICAvLyBNb250aCB3L2xlYWRpbmcgMDsgMDEuLi4xMgogICAgICByZXR1cm4gX3BhZChmLm4oKSwgMik7CiAgICB9LAogICAgTSgpIHsKICAgICAgLy8gU2hvcnRoYW5kIG1vbnRoIG5hbWU7IEphbi4uLkRlYwogICAgICByZXR1cm4gZi5GKCkuc2xpY2UoMCwgMyk7CiAgICB9LAogICAgbigpIHsKICAgICAgLy8gTW9udGg7IDEuLi4xMgogICAgICByZXR1cm4ganNkYXRlLmdldE1vbnRoKCkgKyAxOwogICAgfSwKICAgIHQoKSB7CiAgICAgIC8vIERheXMgaW4gbW9udGg7IDI4Li4uMzEKICAgICAgcmV0dXJuIG5ldyBEYXRlKGYuWSgpLCBmLm4oKSwgMCkuZ2V0RGF0ZSgpOwogICAgfSwKCiAgICAvLyBZZWFyCiAgICBMKCkgewogICAgICAvLyBJcyBsZWFwIHllYXI/OyAwIG9yIDEKICAgICAgY29uc3QgaiA9IGYuWSgpOwogICAgICByZXR1cm4gKChqICUgNCA9PT0gMCkgJiAoaiAlIDEwMCAhPT0gMCkpIHwgKGogJSA0MDAgPT09IDApOwogICAgfSwKICAgIG8oKSB7CiAgICAgIC8vIElTTy04NjAxIHllYXIKICAgICAgY29uc3QgbiA9IGYubigpOwogICAgICBjb25zdCBXID0gZi5XKCk7CiAgICAgIGNvbnN0IFkgPSBmLlkoKTsKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgIHJldHVybiBZICsgKG4gPT09IDEyICYmIFcgPCA5ID8gMSA6IG4gPT09IDEgJiYgVyA+IDkgPyAtMSA6IDApOwogICAgfSwKICAgIFkoKSB7CiAgICAgIC8vIEZ1bGwgeWVhcjsgZS5nLiAxOTgwLi4uMjAxMAogICAgICByZXR1cm4ganNkYXRlLmdldEZ1bGxZZWFyKCk7CiAgICB9LAogICAgeSgpIHsKICAgICAgLy8gTGFzdCB0d28gZGlnaXRzIG9mIHllYXI7IDAwLi4uOTkKICAgICAgcmV0dXJuIGYuWSgpLnRvU3RyaW5nKCkuc2xpY2UoLTIpOwogICAgfSwKCiAgICAvLyBUaW1lCiAgICBhKCkgewogICAgICAvLyBhbSBvciBwbQogICAgICByZXR1cm4ganNkYXRlLmdldEhvdXJzKCkgPiAxMSA/ICJwbSIgOiAiYW0iOwogICAgfSwKICAgIEEoKSB7CiAgICAgIC8vIEFNIG9yIFBNCiAgICAgIHJldHVybiBmLmEoKS50b1VwcGVyQ2FzZSgpOwogICAgfSwKICAgIEIoKSB7CiAgICAgIC8vIFN3YXRjaCBJbnRlcm5ldCB0aW1lOyAwMDAuLjk5OQogICAgICBjb25zdCBIID0ganNkYXRlLmdldFVUQ0hvdXJzKCkgKiAzNmUyOwogICAgICAvLyBIb3VycwogICAgICBjb25zdCBpID0ganNkYXRlLmdldFVUQ01pbnV0ZXMoKSAqIDYwOwogICAgICAvLyBNaW51dGVzCiAgICAgIGNvbnN0IHMgPSBqc2RhdGUuZ2V0VVRDU2Vjb25kcygpOyAvLyBTZWNvbmRzCiAgICAgIHJldHVybiBfcGFkKE1hdGguZmxvb3IoKEggKyBpICsgcyArIDM2ZTIpIC8gODYuNCkgJSAxZTMsIDMpOwogICAgfSwKICAgIGcoKSB7CiAgICAgIC8vIDEyLUhvdXJzOyAxLi4xMgogICAgICByZXR1cm4gZi5HKCkgJSAxMiB8fCAxMjsKICAgIH0sCiAgICBHKCkgewogICAgICAvLyAyNC1Ib3VyczsgMC4uMjMKICAgICAgcmV0dXJuIGpzZGF0ZS5nZXRIb3VycygpOwogICAgfSwKICAgIGgoKSB7CiAgICAgIC8vIDEyLUhvdXJzIHcvbGVhZGluZyAwOyAwMS4uMTIKICAgICAgcmV0dXJuIF9wYWQoZi5nKCksIDIpOwogICAgfSwKICAgIEgoKSB7CiAgICAgIC8vIDI0LUhvdXJzIHcvbGVhZGluZyAwOyAwMC4uMjMKICAgICAgcmV0dXJuIF9wYWQoZi5HKCksIDIpOwogICAgfSwKICAgIGkoKSB7CiAgICAgIC8vIE1pbnV0ZXMgdy9sZWFkaW5nIDA7IDAwLi41OQogICAgICByZXR1cm4gX3BhZChqc2RhdGUuZ2V0TWludXRlcygpLCAyKTsKICAgIH0sCiAgICBzKCkgewogICAgICAvLyBTZWNvbmRzIHcvbGVhZGluZyAwOyAwMC4uNTkKICAgICAgcmV0dXJuIF9wYWQoanNkYXRlLmdldFNlY29uZHMoKSwgMik7CiAgICB9LAogICAgdSgpIHsKICAgICAgLy8gTWljcm9zZWNvbmRzOyAwMDAwMDAtOTk5MDAwCiAgICAgIHJldHVybiBfcGFkKGpzZGF0ZS5nZXRNaWxsaXNlY29uZHMoKSAqIDEwMDAsIDYpOwogICAgfSwKCiAgICAvLyBUaW1lem9uZQogICAgZSgpIHsKICAgICAgLy8gVGltZXpvbmUgaWRlbnRpZmllcjsgZS5nLiBBdGxhbnRpYy9Bem9yZXMsIC4uLgogICAgICAvLyBUaGUgZm9sbG93aW5nIHdvcmtzLCBidXQgcmVxdWlyZXMgaW5jbHVzaW9uIG9mIHRoZSB2ZXJ5IGxhcmdlCiAgICAgIC8vIHRpbWV6b25lX2FiYnJldmlhdGlvbnNfbGlzdCgpIGZ1bmN0aW9uLgogICAgICAvKiAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuZGF0ZV9kZWZhdWx0X3RpbWV6b25lX2dldCgpOwogICAgICAgKi8KICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICJOb3Qgc3VwcG9ydGVkIChzZWUgc291cmNlIGNvZGUgb2YgZGF0ZSgpIGZvciB0aW1lem9uZSBvbiBob3cgdG8gYWRkIHN1cHBvcnQpIgogICAgICApOwogICAgfSwKICAgIEkoKSB7CiAgICAgIC8vIERTVCBvYnNlcnZlZD87IDAgb3IgMQogICAgICAvLyBDb21wYXJlcyBKYW4gMSBtaW51cyBKYW4gMSBVVEMgdG8gSnVsIDEgbWludXMgSnVsIDEgVVRDLgogICAgICAvLyBJZiB0aGV5IGFyZSBub3QgZXF1YWwsIHRoZW4gRFNUIGlzIG9ic2VydmVkLgogICAgICBjb25zdCBhID0gbmV3IERhdGUoZi5ZKCksIDApOwogICAgICAvLyBKYW4gMQogICAgICBjb25zdCBjID0gRGF0ZS5VVEMoZi5ZKCksIDApOwogICAgICAvLyBKYW4gMSBVVEMKICAgICAgY29uc3QgYiA9IG5ldyBEYXRlKGYuWSgpLCA2KTsKICAgICAgLy8gSnVsIDEKICAgICAgY29uc3QgZCA9IERhdGUuVVRDKGYuWSgpLCA2KTsgLy8gSnVsIDEgVVRDCiAgICAgIHJldHVybiBhIC0gYyAhPT0gYiAtIGQgPyAxIDogMDsKICAgIH0sCiAgICBPKCkgewogICAgICAvLyBEaWZmZXJlbmNlIHRvIEdNVCBpbiBob3VyIGZvcm1hdDsgZS5nLiArMDIwMAogICAgICBjb25zdCB0em8gPSBqc2RhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKTsKICAgICAgY29uc3QgYSA9IE1hdGguYWJzKHR6byk7CiAgICAgIHJldHVybiAoCiAgICAgICAgKHR6byA+IDAgPyAiLSIgOiAiKyIpICsgX3BhZChNYXRoLmZsb29yKGEgLyA2MCkgKiAxMDAgKyAoYSAlIDYwKSwgNCkKICAgICAgKTsKICAgIH0sCiAgICBQKCkgewogICAgICAvLyBEaWZmZXJlbmNlIHRvIEdNVCB3L2NvbG9uOyBlLmcuICswMjowMAogICAgICBjb25zdCBPID0gZi5PKCk7CiAgICAgIHJldHVybiBPLnN1YnN0cigwLCAzKSArICI6IiArIE8uc3Vic3RyKDMsIDIpOwogICAgfSwKICAgIFQoKSB7CiAgICAgIC8vIFRpbWV6b25lIGFiYnJldmlhdGlvbjsgZS5nLiBFU1QsIE1EVCwgLi4uCiAgICAgIC8vIFRoZSBmb2xsb3dpbmcgd29ya3MsIGJ1dCByZXF1aXJlcyBpbmNsdXNpb24gb2YgdGhlIHZlcnkKICAgICAgLy8gbGFyZ2UgdGltZXpvbmVfYWJicmV2aWF0aW9uc19saXN0KCkgZnVuY3Rpb24uCiAgICAgIC8qICAgICAgICAgICAgICB2YXIgYWJiciwgaSwgb3MsIF9kZWZhdWx0OwogICAgICBpZiAoIXRhbC5sZW5ndGgpIHsKICAgICAgICB0YWwgPSB0aGF0LnRpbWV6b25lX2FiYnJldmlhdGlvbnNfbGlzdCgpOwogICAgICB9CiAgICAgIGlmICh0aGF0LnBocF9qcyAmJiB0aGF0LnBocF9qcy5kZWZhdWx0X3RpbWV6b25lKSB7CiAgICAgICAgX2RlZmF1bHQgPSB0aGF0LnBocF9qcy5kZWZhdWx0X3RpbWV6b25lOwogICAgICAgIGZvciAoYWJiciBpbiB0YWwpIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YWxbYWJicl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRhbFthYmJyXVtpXS50aW1lem9uZV9pZCA9PT0gX2RlZmF1bHQpIHsKICAgICAgICAgICAgICByZXR1cm4gYWJici50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAoYWJiciBpbiB0YWwpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGFsW2FiYnJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBvcyA9IC1qc2RhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwOwogICAgICAgICAgaWYgKHRhbFthYmJyXVtpXS5vZmZzZXQgPT09IG9zKSB7CiAgICAgICAgICAgIHJldHVybiBhYmJyLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgICovCiAgICAgIHJldHVybiAiVVRDIjsKICAgIH0sCiAgICBaKCkgewogICAgICAvLyBUaW1lem9uZSBvZmZzZXQgaW4gc2Vjb25kcyAoLTQzMjAwLi4uNTA0MDApCiAgICAgIHJldHVybiAtanNkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDsKICAgIH0sCgogICAgLy8gRnVsbCBEYXRlL1RpbWUKICAgIGMoKSB7CiAgICAgIC8vIElTTy04NjAxIGRhdGUuCiAgICAgIHJldHVybiAiWS1tLWRcXFRIOmk6c1AiLnJlcGxhY2UoZm9ybWF0Q2hyLCBmb3JtYXRDaHJDYik7CiAgICB9LAogICAgcigpIHsKICAgICAgLy8gUkZDIDI4MjIKICAgICAgcmV0dXJuICJELCBkIE0gWSBIOmk6cyBPIi5yZXBsYWNlKGZvcm1hdENociwgZm9ybWF0Q2hyQ2IpOwogICAgfSwKICAgIFUoKSB7CiAgICAgIC8vIFNlY29uZHMgc2luY2UgVU5JWCBlcG9jaAogICAgICByZXR1cm4gKGpzZGF0ZSAvIDEwMDApIHwgMDsKICAgIH0sCiAgfTsKICB0aGlzLmRhdGUgPSBmdW5jdGlvbiAoZm9ybWF0LCB0aW1lc3RhbXApIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQogICAganNkYXRlID0KICAgICAgdGltZXN0YW1wID09PSB1bmRlZmluZWQKICAgICAgICA/IG5ldyBEYXRlKCkgLy8gTm90IHByb3ZpZGVkCiAgICAgICAgOiB0aW1lc3RhbXAgaW5zdGFuY2VvZiBEYXRlCiAgICAgICAgPyBuZXcgRGF0ZSh0aW1lc3RhbXApIC8vIEpTIERhdGUoKQogICAgICAgIDogbmV3IERhdGUodGltZXN0YW1wICogMTAwMCk7IC8vIFVOSVggdGltZXN0YW1wIChhdXRvLWNvbnZlcnQgdG8gaW50KQogICAgcmV0dXJuIGZvcm1hdC5yZXBsYWNlKGZvcm1hdENociwgZm9ybWF0Q2hyQ2IpOwogIH07CiAgcmV0dXJuIHRoaXMuZGF0ZShmb3JtYXQsIHRpbWVzdGFtcCk7Cn0K"})

	// builtin_log.js
	modules = append(modules, JsModule{File: "builtin_log.js", Code: "ZnVuY3Rpb24gcHJpbnRsbiguLi5hcmdzKSB7CiAgcHJpbnQoLi4uYXJncyk7CiAgcHJpbnQoIlxuIik7Cn0KCmNvbnN0IGxvZyA9IHt9Owp7CiAgY29uc3QgbGV2ZWxzID0geyBFUlJPUjogMSwgSU5GTzogMiwgREVCVUc6IDMgfTsKICBjb25zdCBsb2dMZXZlbCA9IGxldmVsc1soX19lbnZbIkpTU0hfTE9HIl0gfHwgIklORk8iKS50b1VwcGVyQ2FzZSgpXTsKCiAgY29uc3QgcmVzZXQgPSBgXHUwMDFiWzBtYDsKCiAgZnVuY3Rpb24gcmVkKGxpbmUpIHsKICAgIHJldHVybiBgXHUwMDFiWzMxOzFtJHtsaW5lfSR7cmVzZXR9YDsKICB9CgogIGZ1bmN0aW9uIGdyZWVuKGxpbmUpIHsKICAgIHJldHVybiBgXHUwMDFiWzMyOzFtJHtsaW5lfSR7cmVzZXR9YDsKICB9CgogIGZ1bmN0aW9uIGdyYXkobGluZSkgewogICAgcmV0dXJuIGBcdTAwMWJbMjsxbSR7bGluZX0ke3Jlc2V0fWA7CiAgfQoKICBsb2cuZGVidWcgPSBmdW5jdGlvbiBkZWJ1ZyhtZXNzYWdlLCAuLi5hcmdzKSB7CiAgICBpZiAobG9nTGV2ZWwgPj0gbGV2ZWxzLkRFQlVHKSB7CiAgICAgIHN0ZG91dGxvZyhncmF5KGZvcm1hdChtZXNzYWdlLCAuLi5hcmdzKSkpOwogICAgfQogIH07CgogIGxvZy5pbmZvID0gZnVuY3Rpb24gaW5mbyhtZXNzYWdlLCAuLi5hcmdzKSB7CiAgICBpZiAobG9nTGV2ZWwgPj0gbGV2ZWxzLklORk8pIHsKICAgICAgc3Rkb3V0bG9nKGdyZWVuKGZvcm1hdChtZXNzYWdlLCAuLi5hcmdzKSkpOwogICAgfQogIH07CgogIGxvZy5lcnJvciA9IGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UsIC4uLmFyZ3MpIHsKICAgIGlmIChsb2dMZXZlbCA+PSBsZXZlbHMuRVJST1IpIHsKICAgICAgc3RkZXJybG9nKHJlZChmb3JtYXQobWVzc2FnZSwgLi4uYXJncykpKTsKICAgIH0KICB9OwoKICBsb2cuZmF0YWwgPSBmdW5jdGlvbiBmYXRhbChtZXNzYWdlLCAuLi5hcmdzKSB7CiAgICBsb2cuZXJyb3IobWVzc2FnZSwgLi4uYXJncyk7CiAgICBleGl0KDEpOwogIH07Cn0K"})
}
